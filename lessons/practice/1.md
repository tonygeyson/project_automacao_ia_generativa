# Criando testes de API com a ajuda de IA Generativa

Antes de comeÃ§ar, vocÃª precisa inicializar a API, portanto, siga os passos descritos abaixo.

1. A partir da raiz deste projeto, acesse a pasta [`server/`](../../server/) (ex.: `cd server/`)
2. Instale as dependÃªncias da API com o comando `npm install`
3. Inicialize a API com o comando `npm start`
4. Para garantir que a API inicializou com sucesso, acesse `http://localhost:3001/api-docs/` para testÃ¡-la usando o Swagger

Agora que a API estÃ¡ "de pÃ©", tenho trÃªs exercÃ­cios pra vocÃª.

Leia cada um e divirta-se!

## ExercÃ­cio 1 ğŸ¯ - Prompt simples

> ğŸ‘¨â€ğŸ« Usar o ChatGPT e/ou GitHub Copilot Web

### Prompt - exercÃ­cio 1

Escreva testes de API com Cypress com base nos requisitos abaixo, delimitados por ```md```.

```md
# API

The API offers one endpoint:

## GET /customers

This endpoint accepts four query parameters, as listed below.

### Query parameters

- `page` (optional; current page - default is 1)
- `limit` (optional; number of customers to be shown per page - default is 10)
- `size` (optional; filter customers by size: 'Small', 'Medium', 'Enterprise', 'Large Enterprise', 'Very Large Enterprise' - default is 'All')
- `industry` (optional; filter customers by business industry: 'Logistics', 'Retail', 'Technology', 'HR', 'Finance' - default is 'All')

Below is an example of how the request URL would look like if you wanted to retrieve ten medium-sized customers from the technology industry on page two:

`http://localhost:3001/customers?page=2&limit=10&size=Medium&industry=technology`

### Response body

If there are customers in the database, the following JSON structure should be returned after a successful request.

\```json
{
  "customers": [
    {
      "id": 1,
      "name": "Thompson, Zboncak and Mueller",
      "employees": 850,
      "contactInfo": null,
      "size": "Medium",
      "industry": "Technology",
      "address": {
        "street": "988 Kimberly Fort Apt. 921",
        "city": "Lake Tracy",
        "state": "Connecticut",
        "zipCode": "07115",
        "country": "United States of America"
      }
    },
    {
      "id": 2,
      "name": "Americas Inc.",
      "employees": 200,
      "contactInfo": {
        "name": "John Smith",
        "email": "jsmith@americasinc.com"
      },
      "size": "Medium",
      "industry": "Technology",
      "address": {
        "street": "5099 Murray Inlet",
        "city": "South Tiffany",
        "state": "Kentucky",
        "zipCode": "08496",
        "country": "United States of America"
      }
    },
    ...
  ],
  "pageInfo": {
    "currentPage": 2,
    "totalPages": 20,
    "totalCustomers": 199
  }
}

\```

**Notes:**

- The **contactInfo** and **address** values are `null` when the customer doesn't have contact or address information in the database;
- The `size` attribute in the response for each customer is dynamically determined based on the number of employees according to the specified criteria:
  - **Small** when the **Number of employees** is less than 100;
  - **Medium** when it is greater or equal to 100 and less than 1000;
  - **Enterprise** when it is greater than or equal to 1000 and less than 10000;
  - **Large Enterprise** when it is greater than or equal to 10000 and less than 50000;
  - **Very Large Enterprise** otherwise;
- The `industry` attribute corresponds to the business sector the company belongs to and can be one of the following: **Logistics**, **Retail**, **Technology**, **HR**, **Finance**;
- The API responds with a `400 Bad Request` status code for invalid request parameters, such as negative or non-number values for `page` or `limit`, or unsupported values for `size` or `industry`.

```

## ExercÃ­cio 2 ğŸ¯ - Prompt com mÃºltiplas instruÃ§Ãµes

> ğŸ‘¨â€ğŸ« Usar o ChatGPT e/ou GitHub Copilot Web

### Prompt - exercÃ­cio 2

- Escreva testes de API com Cypress com base nos requisitos abaixo, delimitados por ```md``` (usar a mesma documentaÃ§Ã£o do exercÃ­cio 1)
- Use desestruturaÃ§Ã£o de objetos para as propriedades da resposta da requisiÃ§Ã£o, para que tenhamos apenas as usadas nas asserÃ§Ãµes
- NÃ£o use a palavra "_should_" nas descriÃ§Ãµes dos testes
- Ao usar o comando `cy.request`, use-o no seguinte formato: `cy.request('verb', 'api-url?queryString=value&anotherQueryString=value')`
- Obtenha a URL da API usando o mÃ©todo `Cypress.env`
- Ao definir a URL final da API, use _template literals_ para expressÃµes e interpolaÃ§Ã£o de strings
- NÃ£o use ponto e vÃ­rgula no final de nenhuma expressÃ£o JavaScript
- Sempre teste o status retornado (200 ou 400).
- NÃ£o deixe linhas em branco desnecessÃ¡rias, mas deixe linhas em branco entre os blocos `it` para melhorar a legibilidade

```md
[Usar a mesma documentaÃ§Ã£o do exercÃ­cio 1]

```

## ExercÃ­cio 3 ğŸ¯ - MÃºltiplos prompts

> ğŸ‘¨â€ğŸ« Usar o ChatGPT e/ou GitHub Copilot Web

### Prompt 1 - exercÃ­cio 3

OlÃ¡, preciso de ajuda para escrever testes de API para um endpoint de API especÃ­fico.

Enviarei diferentes prompts ao longo do caminho, como algumas instruÃ§Ãµes de _pre-prompt_, arquivos de cÃ³digo, instruÃ§Ãµes gerais, etc. Dessa forma, podemos nos concentrar em uma coisa de cada vez.

Posso enviar as instruÃ§Ãµes de _pre-prompt_?

### Prompt 2 - exercÃ­cio 3

Abaixo estÃ£o algumas instruÃ§Ãµes que quero que vocÃª considere durante nossa conversa.

#### Papel

Aja como um engenheiro de automaÃ§Ã£o de testes experiente em Cypress.

#### Estilo e padrÃµes de codificaÃ§Ã£o

- Use desestruturaÃ§Ã£o de objetos para as propriedades da resposta da requisiÃ§Ã£o, para que tenhamos apenas aquelas usadas nas asserÃ§Ãµes. O mesmo se aplica para outros casos em que a desestruturaÃ§Ã£o de objetos faÃ§a sentido
- Ao usar o comando `cy.request`, use-o no seguinte formato: `cy.request('verb', 'api-url?queryString=value&anotherQueryString=valueâ€™)`
- Obtenha a URL da API usando o mÃ©todo `Cypress.env`
- Ao definir a URL final da API, use _template literals_ para expressÃµes e interpolaÃ§Ã£o de strings
- Para separar testes que recuperam dados com sucesso e cenÃ¡rios de falha, use o recurso `context`
- NÃ£o use ponto e vÃ­rgula no final de nenhuma expressÃ£o JavaScript
- NÃ£o deixe linhas em branco desnecessÃ¡rias, mas deixe linhas em branco entre os blocos `it` para melhorar a legibilidade

#### PrÃ©-instruÃ§Ãµes relacionadas aos testes

- NÃ£o use a palavra '_should_' nas descriÃ§Ãµes dos testes
- Teste um comportamento de cada vez. Ou seja, nÃ£o misture diferentes comportamentos no mesmo teste (por exemplo, ao testar `page`, nÃ£o teste `limit`; ou, ao testar `size`, nÃ£o teste `industry`)
- Para os cenÃ¡rios de erro, teste os limites (como `page` e `limit`) iguais a `0` e `-1`
- Para a requisiÃ§Ã£o bem-sucedida com _query strings_ padrÃ£o, teste a estrutura do corpo da resposta (por exemplo, se _customers_ Ã© um array, os tipos de propriedades (string, nÃºmero, etc.), mas para outros cenÃ¡rios, como os filtragem, teste os dados (por exemplo, ao filtrar por `size=Medium`, apenas clientes Medium sÃ£o retornados - _customers_ do tipo Medium e com pelo menos 100 funcionÃ¡rios, mas nÃ£o mais que 999 funcionÃ¡rios.))
- Ao testar requisiÃ§Ãµes com as _query strings_ padrÃ£o, nÃ£o as passe no comando `cy.request`. Em vez disso, deixe a prÃ³pria API fazer isso para que possamos ter certeza de que os padrÃµes realmente funcionam.
- Sempre teste o status retornado (200 ou 400)
- Teste utilizando o padrÃ£o AAA (_Arrange, Act, Assert_), ou seja, deixe uma linha em branco entre cada uma destas partes de cada teste, para que seja possÃ­vel identificar cada parte facilmente
- Adicione comentÃ¡rios para identificar cada parte do padrÃ£o AAA

No prÃ³ximo prompt, enviarei os arquivos que vocÃª precisa armazenar em seu contexto, para que vocÃª saiba quais testes serÃ£o necessÃ¡rios. Enviarei arquivos JavaScript e Markdown.

### Prompt 3 - exercÃ­cio 3

Escreva testes de API usando Cypress para o cÃ³digo da API fornecido, levando em consideraÃ§Ã£o seus requisitos e as instruÃ§Ãµes de _pre-prompt_.

[Anexar os arquivos [server/README.md](../../server/README.md)], [server/server.js](../../server/server.js)], [server/db/index.js](../../server/db/index.js)] e [server/db/staticCustomers.js](../../server/db/staticCustomers.js)].

### Prompt 4 - exercÃ­cio 3

Agora, escreva os mesmos testes usando o Playwright, para que eu possa comparar as soluÃ§Ãµes e decidir qual _framework_ de testes se adequa melhor as minhas necessidades e do meu time.

## Mostre ao mundo o que vocÃª aprendeu ğŸŒ

Para mostrar Ã  sua rede profissional o que vocÃª aprendeu nesta aula, publique o seguinte no LinkedIn.

> Estou fazendo o curso "Testes Automatizados e IA Generativa" da escola online Talking About Testing, no qual aprendi como criar testes de APIs com a ajuda de IA generativa, usando prompts simples, prompts com mÃºltiplas instruÃ§Ãµes e mÃºltiplos prompts.
>
> ğŸ‘¨â€ğŸ« Lembre-se de me marcar em sua publicaÃ§Ã£o. [Aqui estÃ¡ meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

Agora que aprendemos a criar testes de API com ajuda de IA generativa, vamos criar alguns [testes de interface grÃ¡fica de usuÃ¡rio (_GUI_)](./2.md).
